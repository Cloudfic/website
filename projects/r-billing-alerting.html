<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>r-billing-alerting</title>
<link rel="stylesheet" href="../assets/css/main.css">
</head><body>
<h1>r-billing-alerting</h1><pre>
resource "google_billing_budget" "billing_budget_alert" {
  billing_account = "0194D0-EB9713-5AE80A" #
  display_name    = "Staging Budget Alert"

  budget_filter {
    projects = ["projects/${var.project_id}"]
  }

  amount {
    specified_amount {
      currency_code = "USD"
      units         = 1000  # Budget limit (e.g., $1,000)
    }
  }

  threshold_rules {
    threshold_percent = 0.5
  }

  threshold_rules {
    threshold_percent = 0.9
  }

  threshold_rules {
    threshold_percent = 1.0
  }

  all_updates_rule {
    pubsub_topic   = google_pubsub_topic.cost_alerts.id
    schema_version = "1.0"
  }
}

resource "google_pubsub_topic" "cost_alerts" {
  name = "dp-topic-cost-alerts-sn-stg"
}

resource "google_pubsub_topic_iam_member" "cost_alerts_publisher" {
  topic = google_pubsub_topic.cost_alerts.name
  role  = "roles/pubsub.publisher"
  member = "serviceAccount:billing-budget-notifications@system.gserviceaccount.com"
}
</pre></body></html>
