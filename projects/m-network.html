<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>m-network</title>
<link rel="stylesheet" href="../assets/css/main.css">
</head><body>
<h1>m-network</h1><pre>
module "network" {
  source  = "terraform-google-modules/network/google"
  version = "9.3.0"

  project_id   = var.project_id
  network_name = "dp-vpc-network-sn-stg"

  subnets = [
    {
      subnet_name                  = "dp-vpc-private-sn-stg"
      subnet_ip                    = "10.150.0.0/20"
      subnet_region                = var.region
      subnet_private_access        = "true"
      description = "Private subnet for ${var.env} data platform"
    },
    {
      subnet_name                  = "dp-vpc-public-sn-stg"
      subnet_ip                    = "10.160.0.0/20"
      subnet_region                = var.region
      subnet_private_access        = "false"
      description = "Public subnet for ${var.env} data platform"
    }
  ]

  auto_create_subnetworks                = false
  delete_default_internet_gateway_routes = false
  routing_mode                           = "GLOBAL"
  description                            = "VPC network for the ${var.env} Data Platform"

  ingress_rules = [
    {
      name          = "dp-vpc-allow-internal-sn-stg"
      description   = "Allow internal traffic within the VPC"
      priority      = 1000
      source_ranges = ["10.150.0.0/20", "10.160.0.0/20"]
      allow = [
        {
          protocol = "tcp"
        },
        {
          protocol = "udp"
        },
        {
          protocol = "icmp"
        }
      ]
      log_config = {
        metadata = "INCLUDE_ALL_METADATA"
      }
    },
    {
      name          = "dp-vpc-allow-icmp-sn-stg"
      description   = "Allows ICMP connections from any source to any instance on the network."
      priority      = 65534
      source_ranges = ["0.0.0.0/0"]
      allow = [
        {
          protocol = "icmp"
        }
      ]
      log_config = {
        metadata = "INCLUDE_ALL_METADATA"
      }
    },
    {
      name          = "dp-vpc-allow-rdp-sn-stg"
      description   = "Allows RDP connections from any source to any instance on the network using port 3389."
      priority      = 65534
      source_ranges = ["0.0.0.0/0"]
      allow = [
        {
          protocol = "tcp",
          ports    = ["3389"]
        }
      ]
      log_config = {
        metadata = "INCLUDE_ALL_METADATA"
      }
    },
    {
      name          = "dp-vpc-allow-ssh-sn-stg"
      description   = "Allows TCP connections from any source to any instance on the network using port 22."
      priority      = 65534
      source_ranges = ["0.0.0.0/0"]
      allow = [
        {
          protocol = "tcp",
          ports    = ["22"]
        }
      ]
      log_config = {
        metadata = "INCLUDE_ALL_METADATA"
      }
    }
  ]
}</pre></body></html>
